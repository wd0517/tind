name: Daily Build

on:
  workflow_dispatch:
  push:
    branches:
      - test-action


jobs:
  diff_tags:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v4
      with:
        python-version: 3.9
    - run: pip install requests
    - run: python diff_tidb_tags.py >> $GITHUB_OUTPUT
      id: tag_list
    outputs:
      tag_list: ${{ steps.tag_list.outputs.DIFF_TAGS}}

  build:
    needs: diff_tags
    strategy:
      fail-fast: true
      matrix:
        tag: ${{ needs.diff_tags.outputs.tag_list }}
    runs-on: ubuntu-latest
    steps:
    - run: echo ${{ matrix.tag }}
